/******************************************************************************/
/* 
 *                        Reference Ramp Generation
 *       
*/
/******************************************************************************/

/*----------------------------------------------------------------------------*/
/* Body Identification                                                        */
/*----------------------------------------------------------------------------*/
#ifdef RAMPGEN_C
    #error "!!! FileName ID. It should be Unique !!!"
#else
    #define RAMPGEN_C
#endif
/*----------------------------------------------------------------------------*/
/* Included files to resolve specific definitions in this file                */
/*----------------------------------------------------------------------------*/
#include "includes.h"

/*----------------------------------------------------------------------------*/
/* Local constants                                                            */
/*----------------------------------------------------------------------------*/


/*----------------------------------------------------------------------------*/
/* Local macros                                                               */
/*----------------------------------------------------------------------------*/


/*----------------------------------------------------------------------------*/
/* Local types                                                                */
/*----------------------------------------------------------------------------*/


/*----------------------------------------------------------------------------*/
/* Local data                                                                 */
/*----------------------------------------------------------------------------*/
static S32 ramp1;	// Ramp data.
static S32 ramp2;

/*----------------------------------------------------------------------------*/
/* Constant local data                                                        */
/*----------------------------------------------------------------------------*/


/*----------------------------------------------------------------------------*/
/* Exported data to other modules                                             */
/*----------------------------------------------------------------------------*/


/*----------------------------------------------------------------------------*/
/* Exported data from other modules                                           */
/*----------------------------------------------------------------------------*/


/*----------------------------------------------------------------------------*/
/* Constant exported data                                                     */
/*----------------------------------------------------------------------------*/


/*----------------------------------------------------------------------------*/
/* Local function prototypes                                                  */
/*----------------------------------------------------------------------------*/


/******************************************************************************/
/*                                                                            */
/*                   I N T E R F A C E   F U N C T I O N S                    */
/*                                                                            */
/******************************************************************************/
/******************************************************************************/
/*
* Purpose: Ramp Calculation
* Input:	ref:   	desired end value
*        	max:	maximal value
*        	min:   	minimal value
*        	incr:  	ramp increment per task1 period (*65536)  (0 => no ramp)
* Output:  	actual reference value
*/
/******************************************************************************/
S16 CalcRamp1(S16 ref,S16 max,S16 min, S16 incr)
{
	S32 tmpl;

	/* new reference limitation */
	if (ref > max) ref = max;
	else if (ref < min) ref = min;
	
	/* process reference ramp */
	if (incr)
	   {
		   min = Hi(ramp1);
		   if (ref > min)      /* reference must be increased */
		      {
		      tmpl = ramp1 + incr;
		      if (Hi(tmpl) > ref)
		         {
		         Hi(ramp1) = ref;
		         Lo(ramp1) = 0;
		         }
		      else ramp1 = tmpl;
		      }
		   else if (ref < min) /* reference must be decreased */
		      {
		      tmpl = ramp1 - incr;
		      if (Hi(tmpl) < ref)
		         {
		         Hi(ramp1) = ref;
		         Lo(ramp1) = 0;
		         }
		      else ramp1 = tmpl;
	      }
	   }
	else /* no ramp */
	   {
	   Hi(ramp1) = ref;
	   Lo(ramp1) = 0;
	   }
	min = Hi(ramp1);
	
	return (min);
}
/******************************************************************************/
/*
* Purpose: Ramp Init
* Input:	none
* Output:  	none
*/
/******************************************************************************/
void init_ramp1(S16 init_val)
{
	Hi(ramp1) = init_val;
	Lo(ramp1) = 0;
}
/******************************************************************************/
/*
* Purpose: Ramp Calculation
* Input:	ref:   	desired end value
*        	max:	maximal value
*        	min:   	minimal value
*        	incr:  	ramp increment per task1 period (*65536)  (0 => no ramp)
* Output:  	actual reference value
*/
/******************************************************************************/
S16 CalcRamp2(S16 ref,S16 max,S16 min, S16 incr)
{
	S32 tmpl;

	/* new reference limitation */
	if (ref > max) ref = max;
	else if (ref < min) ref = min;
	
	/* process reference ramp */
	if (incr)
	   {
	   min = Hi(ramp2);
	   if (ref > min)      /* reference must be increased */
	      {
	      tmpl = ramp2 + incr;
	      if (Hi(tmpl) > ref)
	         {
	         Hi(ramp2) = ref;
	         Lo(ramp2) = 0;
	         }
	      else ramp2 = tmpl;
	      }
	   else if (ref < min) /* reference must be decreased */
	      {
	      tmpl = ramp2 - incr;
	      if (Hi(tmpl) < ref)
	         {
	         Hi(ramp2) = ref;
	         Lo(ramp2) = 0;
	         }
	      else ramp2 = tmpl;
	      }
	   }
	else /* no ramp */
	   {
	   Hi(ramp2) = ref;
	   Lo(ramp2) = 0;
	   }
	min = Hi(ramp2);
	
	return (min);
}
/******************************************************************************/
/*
* Purpose: Ramp Init
* Input:	none
* Output:  	none
*/
/******************************************************************************/
void init_ramp2(S16 init_val)
{
	Hi(ramp2) = init_val;
	Lo(ramp2) = 0;
}

/******************************************************************************/
/******************************************************************************/
/*                                                                            */
/*                       L O C A L   F U N C T I O N S                        */
/*                                                                            */
/******************************************************************************/

/******************************************************************************/
/*
 * Name:      
 * Purpose:   
 * 
*/
/******************************************************************************/

